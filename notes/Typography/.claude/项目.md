### **项目名称**：`Typography`（重构后）  
**定位**：基于 Vue3 + TypeScript 的**静态 HTML 声明式生成框架**，通过 Monorepo 结构实现组件化、可扩展的静态站点开发，最终输出无 JavaScript 的纯净 HTML（原 `static-vue-html` 更名）。  


## **一、项目概述**  
`Typography` 是为**静态站点生成（SSG）**设计的轻量级框架，核心目标是让开发者通过**类 Vue 模板的声明式语法**快速构建静态 HTML 页面。框架支持：  
- 组件化开发（如 `<My-Table>`、`<Datasource>`）；  
- 数据源绑定（本地 CSV/JSON 或远程 API）；  
- 构建时渲染（无客户端 JS，纯静态输出）；  
- Monorepo 统一管理（核心框架、CLI、组件库、文档、示例、测试全流程）。  


## **二、项目目标**  
1. **开发体验**：类 Vue 模板语法，低学习成本，支持组件嵌套与数据传递；  
2. **静态输出**：构建时完成数据获取、组件渲染，最终产物无 JS，SEO 友好；  
3. **Monorepo 统一管理**：核心逻辑、工具链、文档、示例集中维护，避免重复；  
4. **可扩展性**：支持自定义组件、数据源插件，内部工具链可复用；  
5. **Dev 模式友好**：支持实时预览、热更新，快速验证逻辑。  


## **三、项目结构（Monorepo + pnpm）**  
遵循 **“核心包 + 工具包 + 文档 + 示例 + CI/CD”** 的分层设计，根目录通过 `pnpm-workspace.yaml` 管理所有子包（原 `static-vue-html` 目录名调整为 `typography`）：  

```plaintext
typography/                  # 项目根目录（原 static-vue-html）
├── pnpm-workspace.yaml      # Monorepo 工作区配置（更新包名引用）
├── tsconfig.base.json       # 全局 TS 配置（路径别名更新为 @typography/*）
├── package.json             # 根包（管理全局脚本与依赖，名称更新）
└── packages/                # 所有子包集合（包名前缀改为 @typography/）
    ├── core/                # 核心框架（原 @static-vue-html/core）
    │   ├── src/
    │   │   ├── compiler/    # 模板编译（AST 解析、组件树构建）
    │   │   ├── datasource/  # 数据源处理（本地/远程）
    │   │   ├── runtime/     # 运行时逻辑（无客户端 JS）
    │   │   └── index.ts     # 核心入口
    │   ├── package.json     # @typography/core（名称更新）
    │   └── tsconfig.json    # 继承 tsconfig.base.json
    │
    ├── cli/                 # 命令行工具（原 @static-vue-html/cli）
    │   ├── src/
    │   │   ├── commands/    # 命令实现（build、dev、init）
    │   │   └── index.ts     # CLI 入口
    │   ├── package.json     # @typography/cli（依赖 @typography/core）
    │   └── tsconfig.json
    │
    ├── components/          # 内置 UI 组件库（原 @static-vue-html/components）
    │   ├── src/
    │   │   ├── MyTable/     # 表格组件
    │   │   │   ├── src/
    │   │   │   └── index.ts
    │   │   └── Datasource/  # 数据源组件
    │   │       ├── src/
    │   │       └── index.ts
    │   ├── package.json     # @typography/components（依赖 @typography/core）
    │   └── tsconfig.json
    │
    ├── docs/                # 文档（Storybook 驱动，原 @static-vue-html/docs）
    │   ├── .storybook/      # Storybook 配置
    │   │   ├── main.js      # 加载 @typography/components
    │   │   └── preview.js   # 文档预览配置
    │   ├── src/             # 文档内容（组件示例、API 说明）
    │   ├── package.json     # @typography/docs（依赖 @typography/components）
    │   └── tsconfig.json
    │
    ├── playground/          # 示例项目（原 @static-vue-html/playground）
    │   ├── src/
    │   │   ├── pages/       # 页面模板（如 Page.vue）
    │   │   └── datasources/ # 数据源文件（CSV/JSON）
    │   ├── package.json     # @typography/playground（依赖 @typography/cli）
    │   └── vite.config.ts   # 开发服务器配置（Vite）
    │
    ├── tests/               # 统一测试（原 @static-vue-html/tests）
    │   ├── core.test.ts     # 核心逻辑测试（引用 @typography/core）
    │   ├── cli.test.ts      # CLI 命令测试（引用 @typography/cli）
    │   └── components.test.ts # 组件测试（引用 @typography/components）
    │   └── package.json     # @typography/tests（依赖 vitest）
    │
    ├── cicd/                # CI/CD 配置（原 @static-vue-html/cicd）
    │   ├── workflows/
    │   │   ├── build.yml    # 构建与测试（更新项目名）
    │   │   └── deploy.yml   # 部署到 npm/CDN（更新包名）
    │   └── package.json     # @typography/cicd（仅配置文件）
    │
    └── internal/            # 内部构建工具（原 @static-vue-html/internal）
        ├── src/
        │   ├── template-utils/ # 模板工具函数
        │   └── minifier/     # HTML 压缩工具
        ├── package.json     # @typography/internal（private: true）
        └── tsconfig.json
```  


## **四、技术栈**  
| 模块                | 技术选型                                                                 | 说明                                                                                     |
|---------------------|-------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|
| **包管理**           | pnpm                                                                     | 高效、节省空间，支持 Monorepo 工作区                                                     |
| **语言**             | TypeScript 5.x                                                         | 类型安全，提升代码可维护性                                                               |
| **核心框架**         | Vue3 + @vue/compiler-sfc + @vue/server-renderer                         | 利用 Vue 模板编译能力，服务端渲染生成静态 HTML                                           |
| **命令行**           | Commander.js + Chalk                                                   | 实现 CLI 命令（build/dev/init），美化输出                                                 |
| **UI 组件**          | Vue3 单文件组件（SFC）                                                 | 内置组件（MyTable、Datasource）用 SFC 开发，支持插槽与 Props                             |
| **数据源处理**       | Axios（远程） + csv-parser（本地 CSV） + fs（本地文件）                 | 支持多数据源格式，构建时获取数据                                                         |
| **文档**             | Storybook 7.x                                                          | 可视化展示组件用法与框架示例，生成交互式文档                                               |
| **示例项目**         | Vite 4.x                                                               | Playground 用 Vite 搭建，支持热更新、实时预览                                             |
| **测试**             | Vitest 1.x + Vue Testing Library                                       | 单元测试与组件测试，确保逻辑正确性                                                       |
| **CI/CD**            | GitHub Actions                                                         | 自动化构建、测试、部署                                                                   |
| **内部工具**         | esbuild（编译） + html-minifier-terser（压缩）                           | 轻量高效，处理模板编译与 HTML 压缩                                                       |  


## **五、关键配置更新**  
### 1. 根目录 `pnpm-workspace.yaml`  
保持结构不变，但隐含所有子包名称已更新为 `@typography/*`：  
```yaml
packages:
  - 'packages/**'
```  


### 2. 根目录 `package.json`  
更新名称、脚本及依赖引用：  
```json
{
  "name": "typography-monorepo",  # 项目名更新
  "private": true,
  "packageManager": "pnpm@8.15.5",
  "scripts": {
    "build": "pnpm run build --filter \"{packages/**}\" --parallel",
    "test": "pnpm run test --filter \"{packages/**}\" --parallel",
    "dev:cli": "pnpm run dev --filter @typography/cli",  # 子包名更新
    "dev:docs": "pnpm run dev --filter @typography/docs",  # 子包名更新
    "dev:playground": "pnpm run dev --filter @typography/playground",  # 子包名更新
    "release": "pnpm run build && changeset version && changeset publish"
  },
  "devDependencies": {
    "typescript": "^5.2.2",
    "eslint": "^8.57.0",
    "changesets": "^2.26.1"
  }
}
```  


### 3. 全局 `tsconfig.base.json`  
更新路径别名，指向新的包名前缀：  
```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@typography/*": ["packages/*/src"]
    }
  }
}
```  


### 4. 子包 `@typography/core/package.json`  
更新名称与依赖引用：  
```json
{
  "name": "@typography/core",  # 包名更新
  "version": "1.0.0",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "files": ["dist"],
  "scripts": {
    "build": "tsc -p tsconfig.json",
    "test": "vitest run"
  },
  "dependencies": {
    "@typography/internal": "workspace:*"  # 引用内部包（名称更新）
  },
  "devDependencies": {
    "vue": "^3.4.19",
    "@vue/compiler-sfc": "^3.4.19",
    "@vue/server-renderer": "^3.4.19"
  }
}
```  


### 5. 文档与示例引用更新  
- **Storybook（`@typography/docs/.storybook/main.js`）**：加载组件时使用新包名：  
  ```javascript
  module.exports = {
    stories: ['../src/**/*.stories.@(js|jsx|ts|tsx)'],
    addons: ['@storybook/addon-links', '@storybook/addon-essentials'],
    framework: '@storybook/vue3',
    core: {
      builder: 'webpack5'
    }
  };
  ```  

- **Playground（`@typography/playground/src/pages/Page.vue`）**：引用组件时使用新包名：  
  ```vue-like
  <template>
    <Datasource t-datasource.csv="datasource in path:/data/table1.csv" >
        <MyTable>
        <Title>{{ datasource.title }}</Title>
        </MyTable>
    </Datasource>
    <Datasource t-datasource.json="datasource in url:http://data/table1.json" >
        <MyTable>
        <Title>{{ datasource.title }}</Title>
        </MyTable>
    </Datasource>
  </template>

  <script setup lang="ts">
  import { MyTable, Datasource } from '@typography/components';  # 导入路径更新
  </script>
  ```  


## **六、Dev 模式调整**  
各子包的 `dev` 脚本保持功能不变，但依赖的包名已更新：  
- **`@typography/cli`**：启动 CLI 命令行工具，支持 `typography build` 等命令；  
- **`@typography/docs`**：运行 `pnpm run dev` 启动 Storybook，可视化查看组件；  
- **`@typography/playground`**：用 Vite 启动开发服务器，实时预览生成的 HTML；  
- **`@typography/core`**：运行 `pnpm run dev` 启动组件测试与调试。  


## **七、代码规范**

### **编码规范**
- 使用 **TypeScript 严格模式**进行开发
- 遵循 **Vue 3 Composition API** 最佳实践
- 使用 **Prettier** 进行代码格式化
- 使用 **ESLint** 进行代码质量检查
- 组件名使用 **PascalCase** 命名
- 文件名使用 **kebab-case** 命名

### **Git 提交规范**
- `feat:` 新功能
- `fix:` 修复 bug
- `docs:` 文档更新
- `style:` 代码格式调整
- `refactor:` 代码重构
- `test:` 测试相关
- `chore:` 构建工具或辅助工具的变动

### **分支管理**
- `main` 主分支，用于生产环境
- `develop` 开发分支，用于集成新功能
- `feature/*` 功能分支
- `hotfix/*` 热修复分支


## **八、开发指南**

### **环境要求**
- Node.js >= 18.0.0
- pnpm >= 8.0.0
- TypeScript >= 5.0.0

### **常用命令**
```bash
# 安装依赖
pnpm install

# 构建所有包
pnpm run build

# 运行测试
pnpm run test

# 开发模式
pnpm run dev:cli          # CLI 工具开发
pnpm run dev:docs         # 文档开发
pnpm run dev:playground   # 示例项目开发

# 类型检查
pnpm run typecheck

# 代码格式化
pnpm run format

# 发布
pnpm run release
```

### **开发流程**
1. 从 `main` 分支创建 `feature/*` 分支
2. 开发完成后提交代码，遵循提交规范
3. 推送到远程仓库并创建 PR
4. 代码审查通过后合并到 `main` 分支
5. 自动触发 CI/CD 流程进行构建和部署


## **九、架构设计原则**

### **核心原则**
1. **零运行时依赖**：生成的纯静态 HTML，无 JavaScript 执行
2. **组件化开发**：支持组件嵌套、复用和参数传递
3. **数据驱动**：支持多种数据源，构建时数据绑定
4. **类型安全**：全面使用 TypeScript，提供完整类型支持
5. **可扩展性**：插件化架构，支持自定义组件和数据源

### **性能优化**
- 构建时完成所有数据处理和渲染
- 生成的 HTML 进行压缩优化
- 支持 CSS 内联和分离两种模式
- 图片资源自动优化和格式转换


## **十、测试策略**

### **测试类型**
- **单元测试**：核心逻辑和工具函数测试
- **集成测试**：组件间协作测试
- **端到端测试**：完整生成流程测试
- **性能测试**：大型项目构建性能测试

### **测试覆盖率目标**
- 核心模块：>= 90%
- 组件库：>= 85%
- CLI 工具：>= 80%
- 整体覆盖率：>= 85%


## **十一、部署和发布**

### **发布渠道**
- **npm**：核心包和组件库发布到 npm
- **CDN**：构建产物发布到 CDN
- **GitHub Releases**：版本标记和下载

### **版本管理**
- 使用 **Semantic Versioning** (semver)
- 通过 **Changesets** 管理版本变更
- 自动生成 **CHANGELOG.md**

### **CI/CD 流程**
1. 代码提交触发自动构建
2. 运行所有测试用例
3. 类型检查和代码质量检查
4. 构建产物生成
5. 自动发布到对应渠道


## **十二、社区参与**

### **贡献指南**
1. Fork 项目到个人仓库
2. 创建功能分支进行开发
3. 确保测试通过并遵循代码规范
4. 提交 PR 并描述变更内容
5. 等待代码审查和合并

### **问题反馈**
- 通过 **GitHub Issues** 报告 bug
- 提供详细的复现步骤和环境信息
- 标注问题类型和优先级

### **功能请求**
- 在 Issues 中描述功能需求
- 说明使用场景和预期效果
- 社区讨论和评估可行性


---

**项目维护者**：Typography 开发团队
**最后更新**：2024年11月
**文档版本**：v1.0.0 