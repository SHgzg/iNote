# Typography 代码风格规范

## 一、通用规范

### 1.1 命名规范

**文件命名**
- 使用 `kebab-case` 命名：`my-component.vue`、`data-source.ts`
- 测试文件添加 `.test` 或 `.spec` 后缀：`my-component.test.ts`
- 类型定义文件使用 `.d.ts` 后缀

**目录命名**
- 使用 `kebab-case` 命名：`src/components/`、`src/utils/`
- 避免使用缩写，保持名称清晰易懂

**变量命名**
- 使用 `camelCase` 命名：`const userName = 'test'`
- 常量使用 `UPPER_SNAKE_CASE` 命名：`const MAX_SIZE = 100`
- 接口和类型使用 `PascalCase` 命名：`interface DataSource {}`

**函数命名**
- 使用 `camelCase` 命名
- 动词开头，语义明确：`getUserInfo()`、`validateForm()`
- 事件处理函数以 `handle` 开头：`handleClick()`、`handleSubmit()`

**组件命名**
- 使用 `PascalCase` 命名：`MyTable`、`DataSource`
- 组件名应该完整表达其功能和用途
- 避免使用通用名称如 `Item`、`Data`

### 1.2 代码格式

**缩进**
- 统一使用 2 个空格缩进
- 不使用 Tab 字符

**分号**
- 语句末尾必须使用分号

**引号**
- 字符串统一使用单引号
- JSX/模板字符串中使用双引号

**换行**
- 行长度限制在 100 字符
- 长表达式合理换行，操作符放在行末

## 二、TypeScript 规范

### 2.1 类型定义

```typescript
// ✅ 推荐：明确的类型定义
interface User {
  id: number;
  name: string;
  email?: string; // 可选属性
  readonly createdAt: Date; // 只读属性
}

// ✅ 推荐：使用泛型
interface ApiResponse<T> {
  data: T;
  status: number;
  message: string;
}

// ❌ 避免：使用 any
const data: any = fetchData();
```

### 2.2 函数定义

```typescript
// ✅ 推荐：明确的参数和返回类型
function fetchData(url: string): Promise<ApiResponse<User>> {
  return fetch(url).then(res => res.json());
}

// ✅ 推荐：箭头函数
const processUser = (user: User): ProcessedUser => {
  return {
    id: user.id,
    fullName: `${user.firstName} ${user.lastName}`
  };
};
```

### 2.3 类定义

```typescript
// ✅ 推荐：使用访问修饰符
class DataSourceManager {
  private sources: Map<string, DataSource> = new Map();

  public constructor(private readonly config: Config) {}

  public addSource(name: string, source: DataSource): void {
    this.sources.set(name, source);
  }

  public getSource(name: string): DataSource | undefined {
    return this.sources.get(name);
  }
}
```

## 三、Vue 3 组件规范

### 3.1 单文件组件结构

```vue
<template>
  <!-- 模板内容 -->
</template>

<script setup lang="ts">
// 导入
import { ref, computed, onMounted } from 'vue';
import type { User } from './types';

// Props 定义
interface Props {
  title: string;
  users: User[];
  readonly?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  readonly: false
});

// Emits 定义
interface Emits {
  update: [value: string];
  delete: [id: number];
}

const emit = defineEmits<Emits>();

// 响应式数据
const count = ref(0);
const loading = ref(false);

// 计算属性
const filteredUsers = computed(() => {
  return props.users.filter(user => user.active);
});

// 方法
const handleUpdate = (value: string) => {
  emit('update', value);
};

// 生命周期
onMounted(() => {
  console.log('Component mounted');
});
</script>

<style scoped>
/* 组件样式 */
</style>
```

### 3.2 组件命名

```typescript
// ✅ 推荐：语义化的组件名
export default defineComponent({
  name: 'UserTable',
  // ...
});

// 或者在 setup 语法中
<script setup lang="ts">
defineOptions({
  name: 'UserTable'
});
</script>
```

### 3.3 Props 和 Emits

```typescript
// ✅ 推荐：使用 TypeScript 接口定义 Props
interface Props {
  title: string;
  items: Array<{ id: number; name: string }>;
  disabled?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  disabled: false
});

// ✅ 推荐：明确的 Emits 类型
interface Emits {
  'update:modelValue': [value: string];
  'item-click': [item: { id: number; name: string }];
}

const emit = defineEmits<Emits>();
```

## 四、CSS/SCSS 规范

### 4.1 类命名

```css
/* ✅ 推荐：BEM 命名规范 */
.user-table {
  &__header {
    /* 块内元素 */
  }

  &__title {
    /* 块内元素 */
  }

  &--highlighted {
    /* 块修饰符 */
  }
}

/* ✅ 推荐：功能性类名 */
.text-center { text-align: center; }
.mb-4 { margin-bottom: 1rem; }
```

### 4.2 样式组织

```scss
// 1. 变量定义
$primary-color: #007bff;
$border-radius: 4px;

// 2. 混合器
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

// 3. 组件样式
.user-table {
  @include flex-center;
  background-color: $primary-color;
  border-radius: $border-radius;
}
```

## 五、测试规范

### 5.1 单元测试

```typescript
// ✅ 推荐：清晰的测试描述
describe('DataSourceManager', () => {
  let manager: DataSourceManager;

  beforeEach(() => {
    manager = new DataSourceManager(mockConfig);
  });

  describe('addSource', () => {
    it('should add a new data source', () => {
      const source = new MockDataSource();
      manager.addSource('test', source);

      expect(manager.getSource('test')).toBe(source);
    });

    it('should throw error for duplicate source name', () => {
      const source = new MockDataSource();
      manager.addSource('test', source);

      expect(() => manager.addSource('test', source))
        .toThrow('Source name already exists');
    });
  });
});
```

### 5.2 组件测试

```typescript
import { mount } from '@vue/test-utils';
import UserTable from './UserTable.vue';

describe('UserTable', () => {
  it('should render users correctly', async () => {
    const users = [
      { id: 1, name: 'John', active: true },
      { id: 2, name: 'Jane', active: false }
    ];

    const wrapper = mount(UserTable, {
      props: { users }
    });

    expect(wrapper.findAll('.user-row')).toHaveLength(2);
    expect(wrapper.text()).toContain('John');
    expect(wrapper.text()).toContain('Jane');
  });
});
```

## 六、Git 提交规范

### 6.1 提交信息格式

```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

**Type 类型**
- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式调整（不影响功能）
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建工具或辅助工具的变动

**示例**
```bash
git commit -m "feat(core): add data source validation"
git commit -m "fix(cli): resolve build error on Windows"
git commit -m "docs(components): update API documentation"
```

## 七、代码审查清单

### 7.1 提交前检查

- [ ] 代码通过所有测试
- [ ] 类型检查通过（`pnpm run typecheck`）
- [ ] 代码格式化（`pnpm run format`）
- [ ] 没有 console.log 和调试代码
- [ ] 提交信息符合规范
- [ ] 添加必要的测试用例

### 7.2 代码质量

- [ ] 函数和类的职责单一
- [ ] 避免重复代码
- [ ] 错误处理完善
- [ ] 性能考虑合理
- [ ] 安全性检查通过

---

## 工具配置

### ESLint 配置
```json
{
  "extends": [
    "@typescript-eslint/recommended",
    "plugin:vue/vue3-recommended"
  ],
  "rules": {
    "no-console": "warn",
    "no-debugger": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "vue/component-definition-name-casing": ["error", "PascalCase"]
  }
}
```

### Prettier 配置
```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100
}
```

---

遵循这些规范将确保代码质量和团队协作效率。